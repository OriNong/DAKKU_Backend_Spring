<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.re.kh.mapper.ChatMapper">

    <insert id="createRoom" parameterType="RoomVO">
        INSERT INTO CHATROOMTABLE (ROOM_ID, USER_ID, FRIEND_ID) VALUES (#{roomId}, #{userID}, #{friendID})
    </insert>

    <select id="roomSearch" parameterType="RoomVO" resultType="String">
        SELECT ROOM_ID
        FROM CHATROOMTABLE
        WHERE LEAST(user_id, friend_id) = LEAST(#{user_id}, #{friend_id})
        AND GREATEST(user_id, friend_id) = GREATEST(#{user_id}, #{friend_id})
    </select>

    <insert id="saveMsg" parameterType="MessageVO">
        INSERT INTO CHATMESSAGETABLE (ROOM_ID, USER_ID, FRIEND_ID, MESSAGE) VALUES (#{roomID}, #{userID}, #{friendID}, #{message})
    </insert>

    <select id="messageSearch" parameterType="String" resultType="MessageVO">
        SELECT * FROM CHATMESSAGETABLE WHERE ROOM_ID = #{roomID}
    </select>

    <select id="checkUUID" parameterType="java.util.HashMap" resultType="String">
        SELECT ROOM_ID
        FROM CHATROOMTABLE
        WHERE LEAST(user_id, friend_id) = LEAST(#{userID}, #{friendID})
        AND GREATEST(user_id, friend_id) = GREATEST(#{userID}, #{friendID})
    </select>

</mapper>
